<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.net.yzl.crm.customer.dao.MemberMapper" >
<!--    <resultMap id="BaseResultMap" type="cn.net.yzl.crm.customer.model.Member" >-->
<!--        <id column="id" property="id" jdbcType="INTEGER" />-->
<!--        <result column="member_card" property="memberCard" jdbcType="VARCHAR" />-->
<!--        <result column="member_name" property="memberName" jdbcType="VARCHAR" />-->
<!--        <result column="nick_name" property="nickName" jdbcType="VARCHAR" />-->
<!--        <result column="age" property="age" jdbcType="INTEGER" />-->
<!--        <result column="sex" property="sex" jdbcType="BIT" />-->
<!--        <result column="adver_code" property="adverCode" jdbcType="INTEGER" />-->
<!--        <result column="m_grade_id" property="mGradeId" jdbcType="BIT" />-->
<!--        <result column="is_active" property="isActive" jdbcType="SMALLINT" />-->
<!--        <result column="member_status" property="memberStatus" jdbcType="TINYINT" />-->
<!--        <result column="activity" property="activity" jdbcType="BIT" />-->
<!--        <result column="region_code" property="regionCode" jdbcType="INTEGER" />-->
<!--        <result column="province_code" property="provinceCode" jdbcType="INTEGER" />-->
<!--        <result column="city_code" property="cityCode" jdbcType="INTEGER" />-->
<!--        <result column="total_amount" property="totalAmount" jdbcType="INTEGER" />-->
<!--        <result column="qq" property="qq" jdbcType="INTEGER" />-->
<!--        <result column="wechat" property="wechat" jdbcType="VARCHAR" />-->
<!--        <result column="email" property="email" jdbcType="VARCHAR" />-->
<!--        <result column="source" property="source" jdbcType="INTEGER" />-->
<!--        <result column="address" property="address" jdbcType="VARCHAR" />-->
<!--        <result column="birthday" property="birthday" jdbcType="TIMESTAMP" />-->
<!--        <result column="job_id" property="jobId" jdbcType="INTEGER" />-->
<!--        <result column="first_order_time" property="firstOrderTime" jdbcType="TIMESTAMP" />-->
<!--        <result column="last_order_time" property="lastOrderTime" jdbcType="TIMESTAMP" />-->
<!--        <result column="master_card" property="masterCard" jdbcType="INTEGER" />-->
<!--        <result column="first_order_staff_no" property="firstOrderStaffNo" jdbcType="INTEGER" />-->
<!--        <result column="first_order_am" property="firstOrderAm" jdbcType="INTEGER" />-->
<!--        <result column="order_num" property="orderNum" jdbcType="INTEGER" />-->
<!--        <result column="media_name" property="mediaName" jdbcType="VARCHAR" />-->
<!--        <result column="media_type_code" property="mediaTypeCode" jdbcType="INTEGER" />-->
<!--        <result column="media_type_name" property="mediaTypeName" jdbcType="VARCHAR" />-->
<!--</resultMap>-->
    <sql id="Base_Column_List" >
    id, member_card, member_name, nick_name, age, sex, adver_code, m_grade_code, is_active,
    member_status, activity, region_code, province_code, city_code, total_amount, qq,id_card,

    wechat, email, source, address, birthday, job_code, first_order_time, last_order_time,
    master_card, first_order_staff_no, first_order_am, order_num, media_name, media_type_code,
    media_type_name,intro_no,intro_name,intro_type,source_type,vip_flag
  </sql>

    <insert id="insert" parameterType="cn.net.yzl.crm.customer.model.Member" >
    insert into member ( member_card, member_name,
                        nick_name, age, sex, adver_code,
                        m_grade_code, is_active, member_status,
                        activity, region_code, province_code,
                        city_code, total_amount, qq,
                        wechat, email, source,
                        address, birthday, job_code,
                        first_order_time, last_order_time, master_card,
                        first_order_staff_no, first_order_am, order_num,
                        media_name, media_type_code, media_type_name,
                        intro_no,intro_name,intro_type,source_type,vip_flag
    )
    values ( #{member_card,jdbcType=VARCHAR}, #{member_name,jdbcType=VARCHAR},
            #{nick_name,jdbcType=VARCHAR}, #{age,jdbcType=INTEGER}, #{sex}, #{adver_code,jdbcType=INTEGER},
            #{m_grade_code,jdbcType=VARCHAR}, #{is_active,jdbcType=SMALLINT}, #{member_status,jdbcType=TINYINT},
            #{activity,jdbcType=BIT}, #{region_code,jdbcType=INTEGER}, #{province_code,jdbcType=INTEGER},
            #{city_code,jdbcType=INTEGER}, #{total_amount,jdbcType=INTEGER}, #{qq,jdbcType=VARCHAR},
            #{wechat,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR}, #{source,jdbcType=INTEGER},
            #{address,jdbcType=VARCHAR}, #{birthday,jdbcType=TIMESTAMP}, #{job_code,jdbcType=INTEGER},
            #{first_order_time,jdbcType=TIMESTAMP}, #{last_order_time,jdbcType=TIMESTAMP}, #{master_card,jdbcType=INTEGER},
            #{first_order_staff_no,jdbcType=VARCHAR}, #{first_order_am,jdbcType=INTEGER}, #{order_num,jdbcType=INTEGER},
            #{media_name,jdbcType=VARCHAR}, #{media_type_code,jdbcType=VARCHAR}, #{media_type_name,jdbcType=VARCHAR},
            #{intro_no},#{intro_name},#{intro_type},#{source_type},#{vip_flag}
           )
  </insert>

    <update id="updateByMemberCardSelective" parameterType="cn.net.yzl.crm.customer.model.Member" >
        update member
        <set >

            <if test="adverCode != null" >
                adver_code = #{adver_code,jdbcType=INTEGER},
            </if>
            <if test="mGradeId != null" >
                m_grade_code = #{m_grade_code,jdbcType=BIT},
            </if>
            <if test="isActive != null" >
                is_active = #{is_active,jdbcType=SMALLINT},
            </if>
            <if test="memberStatus != null" >
                member_status = #{member_status,jdbcType=TINYINT},
            </if>
            <if test="activity != null" >
                activity = #{activity,jdbcType=BIT},
            </if>
            <if test="regionCode != null" >
                region_code = #{region_code,jdbcType=INTEGER},
            </if>
            <if test="provinceCode != null" >
                province_code = #{province_code,jdbcType=INTEGER},
            </if>
            <if test="cityCode != null" >
                city_code = #{city_code,jdbcType=INTEGER},
            </if>
            <if test="totalAmount != null" >
                total_amount = #{total_amount,jdbcType=INTEGER},
            </if>
            <if test="qq != null" >
                qq = #{qq,jdbcType=INTEGER},
            </if>
            <if test="wechat != null" >
                wechat = #{wechat,jdbcType=VARCHAR},
            </if>
            <if test="email != null" >
                email = #{email,jdbcType=VARCHAR},
            </if>
            <if test="source != null" >
                source = #{source,jdbcType=INTEGER},
            </if>
            <if test="address != null" >
                address = #{address,jdbcType=VARCHAR},
            </if>
            <if test="birthday != null" >
                birthday = #{birthday,jdbcType=TIMESTAMP},
            </if>
            <if test="jobId != null" >
                job_code = #{job_code,jdbcType=INTEGER},
            </if>
            <if test="firstOrderTime != null" >
                first_order_time = #{first_order_time,jdbcType=TIMESTAMP},
            </if>
            <if test="lastOrderTime != null" >
                last_order_time = #{last_order_time,jdbcType=TIMESTAMP},
            </if>
            <if test="masterCard != null" >
                master_card = #{master_card,jdbcType=INTEGER},
            </if>
            <if test="firstOrderStaffNo != null" >
                first_order_staff_no = #{first_order_staff_no,jdbcType=INTEGER},
            </if>
            <if test="firstOrderAm != null" >
                first_order_am = #{first_order_am,jdbcType=INTEGER},
            </if>
            <if test="orderNum != null" >
                order_num = #{order_num,jdbcType=INTEGER},
            </if>
            <if test="mediaName != null" >
                media_name = #{media_name,jdbcType=VARCHAR},
            </if>
            <if test="mediaTypeCode != null" >
                media_type_code = #{media_type_code,jdbcType=INTEGER},
            </if>
            <if test="mediaTypeName != null" >
                media_type_name = #{media_type_name,jdbcType=VARCHAR},
            </if>
        </set>
        where member_card = #{member_card,jdbcType=VARCHAR}
    </update>

    <update id="updateByPrimaryKey" parameterType="cn.net.yzl.crm.customer.model.Member" >
    update member
    set member_card = #{member_card,jdbcType=VARCHAR},
        member_name = #{member_name,jdbcType=VARCHAR},
        nick_name = #{nick_name,jdbcType=VARCHAR},
        age = #{age,jdbcType=INTEGER},
        sex = #{sex,jdbcType=BIT},
        adver_code = #{adver_code,jdbcType=VARCHAR},
        m_grade_code = #{m_grade_code,jdbcType=BIT},
        is_active = #{is_active,jdbcType=SMALLINT},
        member_status = #{member_status,jdbcType=TINYINT},
        activity = #{activity,jdbcType=BIT},
        region_code = #{region_code,jdbcType=INTEGER},
        province_code = #{province_code,jdbcType=INTEGER},
        city_code = #{city_code,jdbcType=INTEGER},
        total_amount = #{total_amount,jdbcType=INTEGER},
        qq = #{qq,jdbcType=INTEGER},
        wechat = #{wechat,jdbcType=VARCHAR},
        email = #{email,jdbcType=VARCHAR},
        source = #{source,jdbcType=INTEGER},
        address = #{address,jdbcType=VARCHAR},
        birthday = #{birthday,jdbcType=TIMESTAMP},
        job_code = #{job_code,jdbcType=VARCHAR},
        first_order_time = #{first_order_time,jdbcType=TIMESTAMP},
        last_order_time = #{last_order_time,jdbcType=TIMESTAMP},
        master_card = #{master_card,jdbcType=INTEGER},
        first_order_staff_no = #{first_order_staff_no,jdbcType=INTEGER},
        first_order_am = #{first_order_am,jdbcType=INTEGER},
        order_num = #{order_num,jdbcType=INTEGER},
        media_name = #{media_name,jdbcType=VARCHAR},
        media_type_code = #{media_type_code,jdbcType=INTEGER},
        media_type_name = #{media_type_name,jdbcType=VARCHAR}
    where id = #{id,jdbcType=INTEGER}
  </update>

    <select id="findPageByCondition"  resultType="cn.net.yzl.crm.customer.model.Member" parameterType="cn.net.yzl.crm.customer.dto.member.MemberSerchConditionDTO">
        SELECT
        m.id,
        m.member_card ,
        m.member_name ,
        m.sex ,
        m.media_name ,
        m.media_type_name ,
        m.member_status ,
        m.activity ,
        m.m_grade_code ,
        m.is_active ,
        m.region_code ,
        m.total_amount ,
        m.last_order_time,
        m.address,
        m.job_code,
        m.first_order_time,
        m.last_order_time,
        m.master_card,
        m.first_order_staff_no,
        m.intro_no,
        m.intro_name,
        m.intro_type,
        m.media_id,
        m.media_type_code,
        m.region_code,
        m.province_code,
        m.city_code,
        m.qq,
        m.wechat,
        m.email,
        m.vip_flag,
        m.source_type

        FROM
        member m
        <where>
            1=1
            <if test="memberName != null and memberName != ''">
                and (m.member_card = #{memberName} or m.member_name = #{memberName})
            </if>
            <if test="media_id != null and media_id != 0">
                and m.media_id = #{media_id}
            </if>
            <if test="adver_code != null and adver_code != 0">
                and m.adver_code = #{adver_code}
            </if>
            <if test="memberStatus != null and memberStatus != ''">
                and m.member_status = #{memberStatus}
            </if>
            <if test="mGradeCode != null and mGradeCode != ''">
                and m.m_grade_code = #{mGradeCode}
            </if>
            <if test="lastOrderTimeStart != null and lastOrderTimeStart != ''">
                and m.last_order_time <![CDATA[ >= ]]> #{lastOrderTimeStart}
            </if>
            <if test="lastOrderTimeEnd != null and lastOrderTimeEnd != ''">
                and m.last_order_time <![CDATA[ <= ]]> #{lastOrderTimeStart}
            </if>
<!--            <if test="diseaseId != null and diseaseId != '' ">-->
<!--                and d.disease_id = #{diseaseId}-->
<!--            </if>-->
<!--            <if test="diseasePid != null and diseasePid != '' and (diseaseId == null or diseaseId == '' )">-->
<!--                and d.disease_id = #{diseasePid}-->
<!--            </if>-->
        </where>
    </select>
    <!--根据顾客号查询顾客基本信息 -->
    <select id="selectMemberByCard" parameterType="java.lang.String" resultType="cn.net.yzl.crm.customer.model.Member">
        SELECT
        <include refid="Base_Column_List" />
        FROM member
        WHERE member_card = #{memberCard}
    </select>
    <select id="getMemberGrad" resultType="cn.net.yzl.crm.customer.model.MemberGrad" >
        select id,no,name from member_type
    </select>

</mapper>